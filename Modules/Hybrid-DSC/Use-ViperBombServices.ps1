# ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____  
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\   ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯   //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//  [ Secure Digits Plus LLC | Hybrid | Desired State Controller ]  \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯       _____________________________________________________        ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯        __/¯¯\__[ Dynamically Engineered Digital Security ]__/¯¯\__         ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\  _________________________ ________________ ___________________________________  //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯\\__//¯¯\\__//¯¯\\__// | Application Development | Virtualization | Network and Hardware Magistration | \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\  ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯  //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//   https://www.securedigitsplus.com | Server-Client | Seedling-Spawning Script    \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\___¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯   ¯¯¯¯¯¯¯¯¯¯¯¯¯   ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ___//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\   [ Provisional Author : Michael C Cook Sr. | "The Buck Stops Here" ]    //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//   ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__/====\__/----\__/====\__/----\__/====\__/----\__/====\__/----\__/====\__/----\__/====\__/----\__/====\__/----\__/====\__/----\__/====\__/----\__// 
#//¯¯    
#\\  [ Use-ViperBombServices ] @: Services & Group Policy Template Generator [ Extensively Modified version of "MadBomb122" & Charles Spark's scripts ] 
#//   ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____      
#\\__/----\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//==\\__/---\\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//==\\___  
#//¯¯\\___________________________________________________________________________________¯¯¯¯ -- ¯¯¯¯ ¯¯ ¯¯¯¯ -- ¯¯¯¯ ¯¯ ¯¯¯¯ -- ¯¯¯¯ ¯¯ ¯¯¯¯ -- ¯¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\___ __ ____ -- ____ __ ____ -- ____ __ ____ -- ____ __ ___// 
# ¯¯¯\\__[ Initial Script Prerequisite Declarations ]____________________________________//¯¯\----/¯¯\\==//¯¯\----/¯¯\\==//¯¯\----/¯¯\\==//¯¯\----/¯¯¯  
#     ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯      
#
#     Foreword: This script has been extensively modified/completely revamped, however I still make every effort to credit the original authors.
#     ¯¯¯¯¯¯¯¯                       ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯          ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯
#               Revisions include, the 'code-behind' PowerShell script, as well as the XAML GUI.
#
#               MadBomb122 has a real name and in respect to him, I have chosen to leave that information outside of this script.
#               I have collaborated with MadBomb122 over the course of the last 6-7 months, tentatively, in helping to teach him some refinement
#               techniques on my journey to advance my Application Development experience.
#
#               The desired end result of working with this script, is to easily implement government grade STIG templates for end users, which 
#               you can find some of those technical details/documents here -> @ https://github.com/nsacyber/Windows-Secure-Host-Baseline
#              
#               - MCC / SDP
#   _________________________
#   [ Original Script & GUI ] -> I will be adding an option that enables the use his legacy script
#   ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯
#       Author: Madbomb122
#      Website: https://GitHub.com/Madbomb122/BlackViperScript/
#   _________________________
#   [ Service Configuration ] -> I will be adding additional service configuration types for Windows Server 2016 +
#   ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯
#       Author: Charles "Black Viper" Sparks
#      Website: http://www.BlackViper.com/
#                                                                                   #____ -- ____    ____ -- ____    ____ -- ____    ____ -- ____      
# ____                                                                            __//¯¯\\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//¯¯\\___  
#//¯¯\\__________________________________________________________________________/¯¯¯    ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯        ____    ____ __ ____ __ ____ __ ____ __ ____ __ ____    ___// 
    Function Resolve-Script # Provides Global Script Definitions _______________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    {#/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯      
        [ CmdLetBinding () ] Param (

            [ Parameter ( ParameterSetName =    "Version" ) ] [ Switch ] $Version   ,
            [ Parameter ( ParameterSetName =     "Update" ) ] [ Switch ] $Company   ,
            [ Parameter ( ParameterSetName =    "MadBomb" ) ] [ Switch ] $MadBomb   ,
            [ Parameter ( ParameterSetName =     "Sparks" ) ] [ Switch ] $Sparks    ,
            [ Parameter ( ParameterSetName =       "Path" ) ] [ Switch ] $Path      ,
            [ Parameter ( ParameterSetName =    "Control" ) ] [ Switch ] $Control   ,
            [ Parameter ( ParameterSetName =  "Copyright" ) ] [ Switch ] $Copyright ,
            [ Parameter ( ParameterSetName =    "Message" ) ] [ Switch ] $Message   ,
            [ Parameter ( ParameterSetName =       "Help" ) ] [ Switch ] $Help      ,
            [ Parameter ( ParameterSetName =   "Services" ) ] [ Switch ] $Services  ,
            [ Parameter ( ParameterSetName =      "Names" ) ] [ Switch ] $Names     ,
            [ Parameter ( ParameterSetName =      "Types" ) ] [ Switch ] $Types     ,
            [ Parameter ( ParameterSetName =     "Config" ) ] [ Switch ] $Config    )

        $Default                 = [ PSCustomObject ]@{

            PassedArgs           = If ( ! $Args ) { "N/A" } Else { $Args }
            TermsOfService       = 0
            DisplayActive        = 1
            DisplayInactive      = 1
            DisplaySkipped       = 1
            MiscSimulate         = 0
            MiscXbox             = 1
            MiscChange           = 0
            MiscStopDisabled     = 0
            DevelDiagErrors      = 0
            DevelLog             = 0
            DevelConsole         = 0
            DevelDiagReport      = 0
            BypassBuild          = 0
            BypassEdition        = 0
            BypassLaptop         = 0
            LoggingServiceFile   = "Service.log"
            LoggingScriptFile    = "Script.log"
            BackupRegistryFile   = "Backup.reg"
            BackupTemplateFile   = "Backup.csv"
            ServiceConfig        = "Black Viper (Sparks v1.0)"
            ScriptConfig         = "DevOPS (MC/SDP v1.0)"
            Profile              = $Null

        }

        $QMark                   = ( Get-Service *_* | ? ServiceType -eq 224 )[0].Name.Split( '_' )[-1]

        If ( $Version )
        {
            $Default | % { 

                [ PSCustomObject ]@{
    
                    Version        = "ViperBomb v7.0.0"
                    Date           = "2020-01-25"
                    Script         = $_.ScriptConfig
                    Service        = $_.ServiceConfig
                    Release        = "Development"
                }
            }
        }

        If ( $Company )
        {
            "https://github.com/secure-digits-plus-llc/FightingEntropy" | % {

                [ PSCustomObject ]@{

                    Base    = "$_"
                    About   = "$_#secure-digits-plus-fighting-entropy"
                    Service = "$_/blob/master/Module/Services/$( $Default.ServiceConfig )"
                    Site    = "https://www.securedigitsplus.com"
                }
            }
        }

        If ( $MadBomb )
        {
            "https://github.com/madbomb122/BlackViperScript" | % { 

                [ PSCustomObject ]@{

                    Base   = "$_"
                    About  = "$_/blob/master/README.md"
                    Donate = "https://www.amazon.com/gp/registry/wishlist/YBAYWBJES5DE/"
                }
            }
        }

        If ( $Sparks )
        {
            [ PSCustomObject ]@{

                Site       = "http://www.blackviper.com"
            }
        }

        If ( $Path )
        {
            ( $PSCommandPath , $PSISE.CurrentFile.FullPath )[ $PSISE -ne $Null ] | % {
            
                [ PSCustomObject ]@{ 
            
                    Parent = Split-Path $_ -Parent
                    Leaf   = Split-Path $_ -Leaf
                }
            }
        }

        If ( $Control )
        {
            $Default
        }

        If ( $Copyright )
        {   
            "Copyright (c) 2019 Zero Rights Reserved                                 " ,
            "Services Configuration by Charles 'Black Viper' Sparks                  " ,
            "------------------------------------------------------------------------" ,
            "The MIT License (MIT) + an added Condition " ,
            ( " " * 72 ) , 
            "Copyright (c) 2017-2019 Madbomb122 " ,
            "[ Black Viper Service Script ] " ,
            ( " " * 72 ) , 
            "Permission is hereby granted, free of charge, to any person obtaining a " ,
            "copy of this software and associated documentation files (the Software)," , 
            "to deal in the Software without restriction, including w/o limitation   " , 
            "the rights to: use/copy/modify/merge/publish/distribute/sublicense,     " , 
            "and/or sell copies of the Software, and to permit persons to whom the   " , 
            "Software is furnished to do so, subject to the following conditions:    " ,
            ( " " * 72 ) , 
            "The above copyright notice(s), this permission notice and ANY original  " , 
            "donation link shall be included in all copies or substantial portions of" , 
            "the Software.                                                           " ,
            ( " " * 72 ) , 
            " The software is provided 'As Is', without warranty of any kind, express" ,
            "or implied, including but not limited to warranties of merchantibility, " ,
            "or fitness for a particular purpose and noninfringement. In no event    " , 
            "shall the authors or copyright holders be liable for any claim, damages " ,
            "or other liability, whether in an action of contract, tort or otherwise," , 
            "arising from, out of or in connection with the software or the use or   " ,
            "other dealings in the software.                                         " ,
            ( " " * 72 ) ,
            "In other words, these terms of service must be accepted in order to use," ,
            "and in no circumstance may the author(s) be subjected to any liability  " ,
            "or damage resultant to its use.                                         " 
        }

        If ( $Message )
        {
            "This utility provides an interface to load and customize " ,
                          "service configuration profiles, such as:`n"                ,
                          "`n"                                                        ,
                          "    Default: Black Viper (Sparks v1.0)`n"                  ,
                          "    Custom: If in proper format`n"                         ,
                          "    Backup: Created via this utility"               -join ''    
        }

        If ( $Help )
        {
            "List of Switches                                                                                          " , 
            "$( "-" * 108 )" , 
            "   " ,
            " Switch            Description of Switch                                                                  " , 
            "   " , 
            " -- Basic Switches --                                                                                     " , 
            "  -atos            Accepts ToS                                                                            " , 
            "  -auto            Implies -atos ... Runs the script to be Automated..                                    " , 
            "                   Closes on - User Input, Errors, or End of Script                                       " , 
            "   " , 
	        " -- Service Configuration Switches --                                                                     " , 
	        "  -default         Runs the script with Services to Default Configuration                                 " , 
            "  -safe            Runs the script with Services to Black Viper's Safe Configuration                      " , 
            "  -tweaked         Runs the script with Services to Black Viper's Tweaked Configuration                   " , 
            "  -lcsc File.csv   Loads Custom Service Configuration, File.csv = Name of your backup/custom file         " , 
            "   " ,
            " --Service Choice Switches--                                                                              " , 
            "  -all             Every windows services will change                                                     " , 
            "  -min             Just the services different from the default to safe/tweaked list                      " , 
            "  -sxb             Skips changes to all XBox Services                                                     " , 
            "   " ,
            " --Update Switches--                                                                                      " , 
	        "  -usc             Checks for Update to Script file before running                                        " , 
            "  -use             Checks for Update to Service file before running                                       " , 
            "  -sic             Skips Internet Check, if you can't ping GitHub.com for some reason                     " , 
            "   " ,
            " --Log Switches--                                                                                         " , 
            "  -log             Makes a log file named using default name Script.log                                   " , 
            "  -log File.log    Makes a log file named File.log                                                        " , 
            "  -baf             Log File of Services Configuration Before and After the script                         " , 
            "   " ,
            " --Backup Service Configuration--                                                                         " , 
            "  -bscc            Backup Current Service Configuration, Csv File                                         " , 
            "  -bscr            Backup Current Service Configuration, Reg File                                         " , 
            "  -bscb            Backup Current Service Configuration, Csv and Reg File                                 " , 
            "   " ,
            " --Display Switches--                                                                                     " , 
            "  -sas             Show Already Set Services                                                              " , 
            "  -snis            Show Not Installed Services                                                            " , 
            "  -sss             Show Skipped Services                                                                  " , 
            "   " ,
            " --Misc Switches--                                                                                        " , 
            "  -dry             Runs the Script and Shows what services will be changed                                " , 
            "  -css             Change State of Service                                                                " , 
            "  -sds             Stop Disabled Service                                                                  " , 
            "   " ,
            " --AT YOUR OWN RISK Switches--                                                                            " , 
            "  -secp            Skips Edition Check by Setting Edition as Pro                                          " , 
            "  -sech            Skips Edition Check by Setting Edition as Home                                         " , 
            "  -sbc             Skips Build Check                                                                      " , 
            "   " ,
            " --Dev Switches--                                                                                         " ,
            "  -devl            Makes a log file with various Diagnostic information, Nothing is Changed               " , 
            "  -diag            Shows diagnostic information, Stops -auto                                              " , 
            "  -diagf           Forced diagnostic information, Script does nothing else                                " , 
            "   " ,
            " --Help--                                                                                                 " ,
            "  -help            Shows list of switches, then exits script.. alt -h                                     " , 
            "  -copy            Shows Copyright/License Information, then exits script                                 "
        }

        If ( $Services )
        {
            [ PSCustomObject ]@{

                Xbox     = 'XblAuthManager' , 'XblGameSave' , 'XboxNetApiSvc' , 'XboxGipSvc' , 'xbgm'

                NetTCP   = 'Msmq' , 'Pipe' , 'Tcp' | % { "Net$_`Activator" }

                DataGrid = 'Index' , 'Scoped' , 'Profile' , 'Name' , 'Status' , 'StartType' , 'DelayedAutoStart' , 'DisplayName' , 'PathName' , 'Description'

                Skip     = @( "BcastDVRUserService" , "DevicePickerUserSvc" , "DevicesFlowUserSvc" , "PimIndexMaintenanceSvc" , 
                              "PrintWorkflowUserSvc" , "UnistoreSvc" , "UserDataSvc" , "WpnUserService" | % { $_ , $QMark -join '_' } ; 
                              
                              'AppXSVC' , 'BrokerInfrastructure' , 'ClipSVC' , 'CoreMessagingRegistrar' , 'DcomLaunch' , 'EntAppSvc' , 'gpsvc' , 'LSM' , 
                              'MpsSvc' , 'msiserver' , 'NgcCtnrSvc' , 'NgcSvc' , 'RpcEptMapper' , 'RpcSs' , 'Schedule' , 'SecurityHealthService' , 'sppsvc' , 
                              'StateRepository' , 'SystemEventsBroker' , 'tiledatamodelsvc' , 'WdNisSvc' , 'WinDefend' ) | Sort
            }
        }

        If ( $Types )
        {
            [ PSCustomObject ]@{

                Types  = @( "H" , "P" | % { "10$_`:D" } ; "S" , "T" | % { "DT:$_" } ; "LT:S" ) | % { "$_+" , "$_-" }
                Titles = @( "Home" , "Pro" | % { "Win10 $_ | Default" } ; "Safe" , "Tweaked" | % { "Desktop | $_" } ; "Laptop | Safe" ) | % { "$_ Max" , "$_ Min" }
            }
        }
        
        If ( $Names )
        {
            @(
            
            (0,4),(1,4),(2,5),(2,6),(3,5) | % { 
                
                "Home,Pro,Desktop,Laptop,Default,Safe,Tweaked".Split(',')[$_] -join '' | % { "$_`Max" , "$_`Min" } | % { "MenuConfig$_" } 
            } ;
            "Feedback,FAQ,About,Copyright,MadBombDonate,MadBombGitHub,BlackViper,SecureDigitsPlus".Split(',') | % { "MenuInfo$_" } ;
            "Search,Select,Grid,Empty"          -Split ',' | % { "ServiceDialog$_" } ;
            "OS,Profile,Build,Chassis"          -Split ',' | % {       "Current$_" } ;
            "Active,Inactive,Skipped"           -Split ',' | % {       "Display$_" } ;
            "Simulate,Xbox,Change,StopDisabled" -Split ',' | % {          "Misc$_" } ;
            "DiagErrors,Log,Console,DiagReport" -Split ',' | % {         "Devel$_" } ;
            "Build,Edition,Laptop"              -Split ',' | % {        "Bypass$_" } ;
            "Service,Script"                    -Split ',' | % { "$_`Browse"  , "$_`File"   } | % { "Logging$_" } ;
            "Registry,Template"                 -Split ',' | % { "$_`Browse"  , "$_`File"   } | % { "Backup$_"  } ;
            "Service,Script"                    -Split ',' | % { "$_`Profile" , "$_`Label"  } ; "Start,Cancel" -Split ',' )
        }

        If ( $Config )
        {
            [ PSCustomObject ]@{ 

                'AJRouter'                                      = '2,2,2,2,2,2,1,1,2,2'
                'ALG'                                           = '2,2,2,2,1,1,1,1,1,1'
                'AppHostSvc'                                    = '3,0,3,0,3,0,3,0,3,0'
                'AppIDSvc'                                      = '2,0,2,0,2,0,2,0,2,0'
                'Appinfo'                                       = '2,0,2,0,2,0,2,0,2,0'
                'AppMgmt'                                       = '0,0,2,2,2,2,1,1,2,2'
                'AppReadiness'                                  = '2,0,2,0,2,0,2,0,2,0'
                'AppVClient'                                    = '0,0,1,0,1,0,1,0,1,0'
                'aspnet_state'                                  = '2,0,2,0,2,0,2,0,2,0'
                'AssignedAccessManagerSvc'                      = '0,0,2,0,2,0,2,0,2,0'
                'AudioEndpointBuilder'                          = '3,0,3,0,3,0,3,0,3,0'
                'AudioSrv'                                      = '3,0,3,0,3,0,3,0,3,0'
                'AxInstSV'                                      = '2,0,2,0,2,0,2,0,2,0'
                'BcastDVRUserService_?????'                     = '2,0,2,0,2,0,2,0,2,0'
                'BDESVC'                                        = '2,0,2,0,2,0,2,0,2,0'
                'BFE'                                           = '3,0,3,0,3,0,3,0,3,0'
                'BITS'                                          = '4,0,4,0,4,0,4,0,4,0'
                'BluetoothUserService_?????'                    = '2,0,2,0,2,0,2,0,2,0'
                'Browser'                                       = '2,0,2,0,2,0,2,0,2,0'
                'BTAGService'                                   = '2,2,2,2,2,2,1,1,2,2'
                'BthAvctpSvc'                                   = '2,2,2,2,2,2,1,1,2,2'
                'BthHFSrv'                                      = '2,2,2,2,2,2,1,1,2,2'
                'bthserv'                                       = '2,2,2,2,2,2,1,1,2,2'
                'c2wts'                                         = '2,0,2,0,2,0,2,0,2,0'
                'camsvc'                                        = '2,0,2,0,2,0,2,0,2,0'
                'CaptureService_?????'                          = '0,0,2,2,2,2,1,1,2,2'
                'CDPSvc'                                        = '4,0,4,0,4,0,4,0,4,0'
                'CDPUserSvc_?????'                              = '3,0,3,0,3,0,3,0,3,0'
                'CertPropSvc'                                   = '2,2,2,2,2,2,1,1,2,2'
                'COMSysApp'                                     = '2,0,2,0,2,0,2,0,2,0'
                'CryptSvc'                                      = '3,0,3,0,3,0,3,0,3,0'
                'CscService'                                    = '0,0,2,2,1,1,1,1,1,1'
                'defragsvc'                                     = '2,0,2,0,2,0,2,0,2,0'
                'DeviceAssociationService'                      = '2,0,2,0,2,0,2,0,2,0'
                'DeviceInstall'                                 = '2,0,2,0,2,0,2,0,2,0'
                'DevicePickerUserSvc_?????'                     = '2,0,2,0,2,0,2,0,2,0'
                'DevQueryBroker'                                = '2,0,2,0,2,0,2,0,2,0'
                'Dhcp'                                          = '3,0,3,0,3,0,3,0,3,0'
                'diagnosticshub.standardcollector.service'      = '2,0,2,0,2,0,2,0,2,0'
                'diagsvc'                                       = '2,0,2,0,2,0,2,0,2,0'
                'DiagTrack'                                     = '3,0,3,0,3,0,3,0,3,0'
                'DmEnrollmentSvc'                               = '2,0,2,0,2,0,2,0,2,0'
                'dmwappushsvc'                                  = '2,2,2,2,1,1,1,1,1,1'
                'Dnscache'                                      = '3,0,3,0,3,0,3,0,3,0'
                'DoSvc'                                         = '4,0,4,0,4,0,4,0,4,0'
                'dot3svc'                                       = '2,0,2,0,2,0,2,0,2,0'
                'DPS'                                           = '3,0,3,0,3,0,3,0,3,0'
                'DsmSVC'                                        = '2,0,2,0,2,0,2,0,2,0'
                'DsRoleSvc'                                     = '2,0,2,0,2,0,2,0,2,0'
                'DsSvc'                                         = '2,0,2,0,2,0,2,0,2,0'
                'DusmSvc'                                       = '3,0,3,0,3,0,3,0,3,0'
                'EapHost'                                       = '2,0,2,0,2,0,2,0,2,0'
                'EFS'                                           = '2,0,2,0,2,0,2,0,2,0'
                'embeddedmode'                                  = '2,0,2,0,2,0,2,0,2,0'
                'EventLog'                                      = '3,0,3,0,3,0,3,0,3,0'
                'EventSystem'                                   = '3,0,3,0,3,0,3,0,3,0'
                'Fax'                                           = '2,2,2,2,1,1,1,1,1,1'
                'fdPHost'                                       = '2,0,2,0,2,0,2,0,2,0'
                'FDResPub'                                      = '2,0,2,0,2,0,2,0,2,0'
                'fhsvc'                                         = '2,0,2,0,2,0,2,0,2,0'
                'FontCache'                                     = '3,0,3,0,3,0,3,0,3,0'
                'FontCache3.0.0.0'                              = '2,0,2,0,2,0,2,0,2,0'
                'FrameServer'                                   = '2,2,2,2,1,1,1,1,1,1'
                'ftpsvc'                                        = '3,0,3,0,3,0,3,0,3,0'
                'GraphicsPerfSvc'                               = '2,0,2,0,2,0,2,0,2,0'
                'hidserv'                                       = '2,0,2,0,2,0,2,0,2,0'
                'hns'                                           = '0,0,2,0,2,0,2,0,2,0'
                'HomeGroupListener'                             = '2,0,2,0,2,0,2,0,2,0'
                'HomeGroupProvider'                             = '2,0,2,0,2,0,2,0,2,0'
                'HvHost'                                        = '2,2,2,2,1,1,1,1,1,1'
                'icssvc'                                        = '2,2,2,2,1,1,1,1,1,1'
                'IKEEXT'                                        = '2,0,2,0,2,0,2,0,2,0'
                'InstallService'                                = '2,0,2,0,2,0,2,0,2,0'
                'iphlpsvc'                                      = '3,3,3,3,3,3,1,1,3,3'
                'IpxlatCfgSvc'                                  = '2,2,2,2,2,2,1,1,2,2'
                'irmon'                                         = '2,2,2,2,1,1,1,1,1,1'
                'KeyIso'                                        = '2,0,2,0,2,0,2,0,2,0'
                'KtmRm'                                         = '2,0,2,0,2,0,2,0,2,0'
                'LanmanServer'                                  = '3,0,3,0,3,0,3,0,3,0'
                'LanmanWorkstation'                             = '3,0,3,0,3,0,3,0,3,0'
                'lfsvc'                                         = '2,2,2,2,1,1,1,1,1,1'
                'LicenseManager'                                = '2,0,2,0,2,0,2,0,2,0'
                'lltdsvc'                                       = '2,0,2,0,2,0,2,0,2,0'
                'lmhosts'                                       = '2,0,2,0,2,0,2,0,2,0'
                'LPDSVC'                                        = '3,0,3,0,3,0,3,0,3,0'
                'LxssManager'                                   = '2,0,2,0,2,0,2,0,2,0'
                'MapsBroker'                                    = '4,4,4,4,1,1,1,1,1,1'
                'MessagingService_?????'                        = '2,0,2,0,2,0,2,0,2,0'
                'MSDTC'                                         = '2,0,2,0,2,0,2,0,2,0'
                'MSiSCSI'                                       = '2,2,2,2,1,1,1,1,1,1'
                'MsKeyboardFilter'                              = '0,0,0,0,0,0,0,0,0,0'
                'MSMQ'                                          = '3,0,3,0,3,0,3,0,3,0'
                'MSMQTriggers'                                  = '3,0,3,0,3,0,3,0,3,0'
                'NaturalAuthentication'                         = '2,2,2,2,2,2,1,1,2,2'
                'NcaSVC'                                        = '2,0,2,0,2,0,2,0,2,0'
                'NcbService'                                    = '2,0,2,0,2,0,2,0,2,0'
                'NcdAutoSetup'                                  = '2,2,2,2,2,2,1,1,2,2'
                'Netlogon'                                      = '2,2,2,2,2,2,1,1,2,2'
                'Netman'                                        = '2,0,2,0,2,0,2,0,2,0'
                'NetMsmqActivator'                              = '3,0,3,0,3,0,3,0,3,0'
                'NetPipeActivator'                              = '3,0,3,0,3,0,3,0,3,0'
                'netprofm'                                      = '2,0,2,0,2,0,2,0,2,0'
                'NetSetupSvc'                                   = '2,0,2,0,2,0,2,0,2,0'
                'NetTcpActivator'                               = '3,0,3,0,3,0,3,0,3,0'
                'NetTcpPortSharing'                             = '2,2,2,2,1,1,1,1,1,1'
                'NlaSvc'                                        = '3,0,3,0,3,0,3,0,3,0'
                'nsi'                                           = '3,0,3,0,3,0,3,0,3,0'
                'OneSyncSvc_?????'                              = '4,0,4,0,4,0,4,0,4,0'
                'p2pimsvc'                                      = '2,0,2,0,2,0,2,0,2,0'
                'p2psvc'                                        = '2,0,2,0,2,0,2,0,2,0'
                'PcaSvc'                                        = '3,0,3,0,3,0,3,0,3,0'
                'PeerDistSvc'                                   = '0,0,2,2,1,1,1,1,1,1'
                'PerfHost'                                      = '2,0,2,0,2,0,2,0,2,0'
                'PhoneSvc'                                      = '2,2,2,2,1,1,1,1,1,1'
                'pla'                                           = '2,0,2,0,2,0,2,0,2,0'
                'PlugPlay'                                      = '2,0,2,0,2,0,2,0,2,0'
                'PNRPAutoReg'                                   = '2,0,2,0,2,0,2,0,2,0'
                'PNRPsvc'                                       = '2,0,2,0,2,0,2,0,2,0'
                'PolicyAgent'                                   = '2,0,2,0,2,0,2,0,2,0'
                'Power'                                         = '3,0,3,0,3,0,3,0,3,0'
                'PrintNotify'                                   = '2,0,2,0,2,0,2,0,2,0'
                'PrintWorkflowUserSvc_?????'                    = '2,0,2,0,2,0,2,0,2,0'
                'ProfSvc'                                       = '3,0,3,0,3,0,3,0,3,0'
                'PushToInstall'                                 = '2,0,2,0,2,0,2,0,2,0'
                'QWAVE'                                         = '2,0,2,0,2,0,2,0,2,0'
                'RasAuto'                                       = '2,0,2,0,2,0,2,0,2,0'
                'RasMan'                                        = '2,0,2,0,2,0,2,0,2,0'
                'RemoteAccess'                                  = '1,0,1,0,1,0,1,0,1,0'
                'RemoteRegistry'                                = '1,0,1,0,1,0,1,0,1,0'
                'RetailDemo'                                    = '2,2,2,2,1,1,1,1,1,1'
                'RmSvc'                                         = '2,0,2,0,2,0,2,0,2,0'
                'RpcLocator'                                    = '2,2,2,2,1,1,1,1,1,1'
                'SamSs'                                         = '3,0,3,0,3,0,3,0,3,0'
                'SCardSvr'                                      = '1,0,1,0,1,0,1,0,1,0'
                'ScDeviceEnum'                                  = '2,2,2,2,1,1,1,1,1,1'
                'SCPolicySvc'                                   = '2,2,2,2,1,1,1,1,1,1'
                'SDRSVC'                                        = '2,0,2,0,2,0,2,0,2,0'
                'seclogon'                                      = '2,0,2,0,2,0,2,0,2,0'
                'SEMgrSvc'                                      = '2,2,2,2,1,1,1,1,1,1'
                'SENS'                                          = '3,0,3,0,3,0,3,0,3,0'
                'Sense'                                         = '0,0,2,0,2,0,2,0,2,0'
                'SensorDataService'                             = '2,2,2,2,1,1,1,1,2,2'
                'SensorService'                                 = '2,2,2,2,1,1,1,1,2,2'
                'SensrSvc'                                      = '2,2,2,2,1,1,1,1,2,2'
                'SessionEnv'                                    = '2,2,2,2,2,2,1,1,2,2'
                'SgrmBroker'                                    = '4,0,4,0,4,0,4,0,4,0'
                'SharedAccess'                                  = '2,2,2,2,1,1,1,1,1,1'
                'SharedRealitySvc'                              = '2,0,2,0,2,0,2,0,2,0'
                'ShellHWDetection'                              = '3,0,3,0,3,0,3,0,3,0'
                'shpamsvc'                                      = '1,0,1,0,1,0,1,0,1,0'
                'smphost'                                       = '2,0,2,0,2,0,2,0,2,0'
                'SmsRouter'                                     = '2,2,2,2,1,1,1,1,1,1'
                'SNMPTRAP'                                      = '2,2,2,2,1,1,1,1,1,1'
                'spectrum'                                      = '2,0,2,0,2,0,2,0,2,0'
                'Spooler'                                       = '3,0,3,0,3,0,3,0,3,0'
                'SSDPSRV'                                       = '2,0,2,0,2,0,2,0,2,0'
                'ssh-agent'                                     = '2,0,2,0,2,0,2,0,2,0'
                'SstpSvc'                                       = '2,0,2,0,2,0,2,0,2,0'
                'StiSvc'                                        = '2,0,2,0,2,0,2,0,2,0'
                'StorSvc'                                       = '2,0,2,0,2,0,2,0,2,0'
                'svsvc'                                         = '2,0,2,0,2,0,2,0,2,0'
                'swprv'                                         = '2,0,2,0,2,0,2,0,2,0'
                'SysMain'                                       = '3,0,3,0,3,0,3,0,3,0'
                'TabletInputService'                            = '2,2,2,2,1,1,1,1,2,2'
                'TapiSrv'                                       = '2,0,2,0,2,0,2,0,2,0'
                'TermService'                                   = '2,2,2,2,2,2,1,1,2,2'
                'Themes'                                        = '3,0,3,0,3,0,3,0,3,0'
                'TieringEngineService'                          = '2,0,2,0,2,0,2,0,2,0'
                'TimeBroker'                                    = '2,0,2,0,2,0,2,0,2,0'
                'TokenBroker'                                   = '2,0,2,0,2,0,2,0,2,0'
                'TrkWks'                                        = '3,0,3,0,3,0,3,0,3,0'
                'TrustedInstaller'                              = '2,0,2,0,2,0,2,0,2,0'
                'tzautoupdate'                                  = '1,0,1,0,1,0,1,0,1,0'
                'UevAgentService'                               = '0,0,1,0,1,0,1,0,1,0'
                'UI0Detect'                                     = '2,0,2,0,2,0,2,0,2,0'
                'UmRdpService'                                  = '2,2,2,2,2,2,1,1,2,2'
                'upnphost'                                      = '2,0,2,0,2,0,2,0,2,0'
                'UserManager'                                   = '3,0,3,0,3,0,3,0,3,0'
                'UsoSvc'                                        = '2,0,2,0,2,0,2,0,2,0'
                'VaultSvc'                                      = '2,0,2,0,2,0,2,0,2,0'
                'vds'                                           = '2,0,2,0,2,0,2,0,2,0'
                'vmcompute'                                     = '0,0,2,0,2,0,2,0,2,0'
                'vmicguestinterface'                            = '2,2,2,2,1,1,1,1,1,1'
                'vmicheartbeat'                                 = '2,2,2,2,1,1,1,1,1,1'
                'vmickvpexchange'                               = '2,2,2,2,1,1,1,1,1,1'
                'vmicrdv'                                       = '2,2,2,2,1,1,1,1,1,1'
                'vmicshutdown'                                  = '2,2,2,2,1,1,1,1,1,1'
                'vmictimesync'                                  = '2,2,2,2,1,1,1,1,1,1'
                'vmicvmsession'                                 = '2,2,2,2,1,1,1,1,1,1'
                'vmicvss'                                       = '2,2,2,2,1,1,1,1,1,1'
                'vmms'                                          = '0,0,3,0,3,0,3,0,3,0'
                'VSS'                                           = '2,0,2,0,2,0,2,0,2,0'
                'W32Time'                                       = '2,0,2,0,2,0,2,0,2,0'
                'W3LOGSVC'                                      = '2,0,2,0,2,0,2,0,2,0'
                'W3SVC'                                         = '3,0,3,0,3,0,3,0,3,0'
                'WaaSMedicSvc'                                  = '2,0,2,0,2,0,2,0,2,0'
                'WalletService'                                 = '2,0,2,0,2,0,2,0,2,0'
                'WarpJITSvc'                                    = '2,0,2,0,2,0,2,0,2,0'
                'WAS'                                           = '2,0,2,0,2,0,2,0,2,0'
                'wbengine'                                      = '2,0,2,0,2,0,2,0,2,0'
                'WbioSrvc'                                      = '2,0,2,0,2,0,2,0,2,0'
                'Wcmsvc'                                        = '3,0,3,0,3,0,3,0,3,0'
                'wcncsvc'                                       = '2,2,2,2,2,2,1,1,2,2'
                'WdiServiceHost'                                = '2,0,2,0,2,0,2,0,2,0'
                'WdiSystemHost'                                 = '2,0,2,0,2,0,2,0,2,0'
                'WebClient'                                     = '2,2,2,2,2,2,1,1,2,2'
                'Wecsvc'                                        = '2,0,2,0,2,0,2,0,2,0'
                'WEPHOSTSVC'                                    = '2,0,2,0,2,0,2,0,2,0'
                'wercplsupport'                                 = '2,0,2,0,2,0,2,0,2,0'
                'WerSvc'                                        = '2,0,2,0,2,0,2,0,2,0'
                'WFDSConSvc'                                    = '2,2,2,2,1,1,1,1,2,2'
                'WiaRpc'                                        = '2,0,2,0,2,0,2,0,2,0'
                'WinHttpAutoProxySvc'                           = '2,0,2,0,2,0,2,0,2,0'
                'Winmgmt'                                       = '3,0,3,0,3,0,3,0,3,0'
                'WinRM'                                         = '2,2,2,2,1,1,1,1,1,1'
                'wisvc'                                         = '2,2,2,2,1,1,1,1,1,1'
                'WlanSvc'                                       = '3,3,3,3,2,2,2,2,3,3'
                'wlidsvc'                                       = '2,0,2,0,2,0,2,0,2,0'
                'wlpasvc'                                       = '2,0,2,0,2,0,2,0,2,0'
                'wmiApSrv'                                      = '2,0,2,0,2,0,2,0,2,0'
                'WMPNetworkSvc'                                 = '2,2,2,2,1,1,1,1,1,1'
                'WMSVC'                                         = '2,0,2,0,2,0,2,0,2,0'
                'workfolderssvc'                                = '2,2,2,2,1,1,1,1,1,1'
                'WpcMonSvc'                                     = '2,2,2,2,1,1,1,1,1,1'
                'WPDBusEnum'                                    = '2,0,2,0,2,0,2,0,2,0'
                'WpnService'                                    = '3,0,3,0,3,0,3,0,3,0'
                'WpnUserService_?????'                          = '3,0,3,0,3,0,3,0,3,0'
                'wscsvc'                                        = '4,0,4,0,4,0,4,0,4,0'
                'WSearch'                                       = '4,0,4,0,4,0,4,0,4,0'
                'wuauserv'                                      = '2,0,2,0,2,0,2,0,2,0'
                'wudfsvc'                                       = '2,0,2,0,2,0,2,0,2,0'
                'WwanSvc'                                       = '2,2,2,2,1,1,1,1,1,1'
                'xbgm'                                          = '2,0,2,0,2,0,2,0,2,0'
                'XblAuthManager'                                = '2,2,2,2,1,1,1,1,1,1'
                'XblGameSave'                                   = '2,2,2,2,1,1,1,1,1,1'
                'XboxGipSvc'                                    = '2,0,2,0,2,0,2,0,2,0'
                'XboxNetApiSvc'                                 = '2,2,2,2,1,1,1,1,1,1'
            }
        }                                                                           #____ -- ____    ____ -- ____    ____ -- ____    ____ -- ____      
}#____                                                                            __//¯¯\\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//¯¯\\___  
#//¯¯\\__________________________________________________________________________/¯¯¯    ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯        ____    ____ __ ____ __ ____ __ ____ __ ____ __ ____    ___// 
    Function Start-DiagnosticCheck #____________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    {#/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯      
        [ CmdLetBinding () ] Param (

            [ Parameter ( ) ] [ PSCustomObject ] $Model )

        $Section              = @( "Script" , "System" | % { "$_ Information" } ; "Initialization" ; "Display" , "Miscellaneous" , 
                                   "Development" , "Bypass/Force" , "Logging" , "Backup" | % { "$_ Settings" } ; "Version Control" ) | % { "[ $_ ]" }

        $Subtable             = 0..9
        
        #---------------------------------------------#
        
        $Script               = Resolve-Script -Version

        $Splat                = @{ 
            
            Items             = "Version" , "Date" , "Script" , "Service" , "Release"
            Values            = $Script | % { $_.Version , $_.Date , $_.Script , $_.Service , $_.Release }
        }

        $Subtable[0]          = New-SubTable @Splat
        
        #---------------------------------------------#

        $MSInfo               = Resolve-Windows -MSInfo  | % { "$( $_.Caption ) [$( $_.OSArchitecture )]" }

        $SKU                  = Resolve-Windows -SKU     | % { $_.SKU }

                                Resolve-Windows -Edition | % { 

            $Build            = $_.Build
            $Version          = $_.Version 
        }

        $Chassis              = Resolve-Windows -Type    | % { $_.Chassis }

        $Splat                = @{ 

            Items             = "Operating System" , "Edition / SKU" , "Build" , "Version" , "Chassis Type"
            Values            = $MSInfo  , $SKU , $Build , $Version , $Chassis
        }

        $Subtable[1]          = New-SubTable @Splat

        #---------------------------------------------#

        $Control              = $( $Model | % { If ( $_ -ne $Null ) { $_ } Else { Resolve-Script -Control } } )

        $Splat                = @{

            Items             = "Argument List" , "Terms of Service" 
            Values            = $Control | % { $_.PassedArgs , $_.TermsOfService }
        }

        $Subtable[2]          = New-SubTable @Splat

        $Splat                = @{

            Items             = "Active" , "Inactive" , "Skipped" | % { "Show $_ SVC" }
            Values            = $Control | % { $_.DisplayActive , $_.DisplayInactive , $_.DisplaySkipped }
        }
        
        $Subtable[3]          = New-SubTable @Splat
        
        $Splat                = @{ 
        
            Items             = "Simulate Changes" , "Xbox Services" , "Change * SVC State" , "Stop * Disabled SVC"
            Values            = $Control | % { $_.MiscSimulate , $_.MiscXbox , $_.MiscChange ,$_.MiscStopDisabled }
        }

        $Subtable[4]          = New-SubTable @Splat

        $Splat                = @{ 

            Items             = "Diagnostic Errors" , "Devel Log" , "Enable Console" , "Report Diagnostic"
            Values            = $Control | % { $_.DevelDiagErrors , $_.DevelLog , $_.DevelConsole , $_.DevelDiagReport }
        }

        $Subtable[5]          = New-Subtable @Splat

        $Splat                = @{ 

            Items             = "Build" , "Edition" , "Laptop" | % { "Bypass $_" }
            Values            = $Control | % { $_.BypassBuild , $_.BypassEdition , $_.BypassLaptop }
        }

        $Subtable[6]          = New-SubTable @Splat

        $Splat                = @{

            Items             = "Service" , "Script" | % { "Log $_ File" }
            Values            = $Control | % { $_.LoggingServiceFile , $_.LoggingScriptFile }
        }

        $Subtable[7]          = New-SubTable @Splat

        $Splat                = @{ 

            Items             = "Registry" , "Template" | % { "Backup $_" }
            Values            = $Control | % { $_.BackupRegistryFile , $_.BackupTemplateFile }
        }

        $Subtable[8]          = New-SubTable @Splat

        $Splat                = @{

            Items             = "Service" ,"Script" | % { "$_ Config" }
            Values            = $Control | % { $_.ServiceConfig , $_.ScriptConfig }
        }

        $Subtable[9]          = New-Subtable @Splat

        $Table                = New-Table -Title "Diagnostic/Startup Panel" -Depth 10 -ID $Section -Table $Subtable
        
        Write-Theme -Table $Table -Prompt "Press Enter to Continue, CTRL+C to Exit" 
                                                                                    #____ -- ____    ____ -- ____    ____ -- ____    ____ -- ____      
}#____                                                                            __//¯¯\\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//¯¯\\___  
#//¯¯\\__________________________________________________________________________/¯¯¯    ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯        ____    ____ __ ____ __ ____ __ ____ __ ____ __ ____    ___// 
    Function Return-ViperBombGUI #______________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    {#/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯      
        [ CmdLetBinding () ] Param (

            [ Parameter ( Mandatory , ParameterSetName =  'Main' ) ][ Switch ] $Main  ,
            [ Parameter ( Mandatory , ParameterSetName = 'Alert' ) ][ Switch ] $Alert )

    If ( $Main )
    {
        $XAML  = Get-XAML -Service
        $Named = Resolve-Script -Names
        $GUI   = Convert-XAMLToWindow -Xaml $XAML -NE $Named -Passthru
    }

    If ( $Alert )
    {
        $XAML = @"
        <Window xmlns        = "http://schemas.microsoft.com/winfx/2006/xaml/presentation"
            xmlns:x          = "http://schemas.microsoft.com/winfx/2006/xaml"
            Title            = "Notice" 
            Height           = "225" 
            Width            = "300" 
            BorderBrush      = "Black" 
            Background       = "White" 
            WindowStyle      = "ToolWindow">
            <Grid Background     = "#FFE5E5E5">
                <GroupBox Header = "Caution" Margin="5">
                    <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height = "3*" />
                    <RowDefinition Height = "25" />
                    <RowDefinition Height = "50" />
                </Grid.RowDefinitions>
                <TextBlock Grid.Row = "0" Margin = "5" Name = "Tbox" TextWrapping = "Wrap"/>
                <CheckBox  Grid.Row = "1" Margin = "5" Name = "Cbox" Content = "CheckBox" HorizontalAlignment = "Left" />
                        <Grid Grid.Row = "2">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width = "*"/>
                                <ColumnDefinition Width = "*"/>
                            </Grid.ColumnDefinitions>
                            <Button Grid.Column = "0" Margin ="10" Name = "Yes" Content = "Yes"  />
                            <Button Grid.Column = "1" Margin ="10" Name = "No"  Content = "No"  />
                        </Grid>
                    </Grid>
                </GroupBox>
            </Grid>
        </Window>
"@

        $Named = "Tbox" , "Cbox" , "Yes" , "No"

        $GUI   = Convert-XAMLToWindow -Xaml $Xaml -NE $Named -Passthru

    }

    [ PSCustomObject ]@{ 

        XAML  = $Xaml
        Named = $Named
        GUI   = $GUI
    }                                                                               #____ -- ____    ____ -- ____    ____ -- ____    ____ -- ____      
}#____                                                                            __//¯¯\\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//¯¯\\___  
#//¯¯\\__________________________________________________________________________/¯¯¯    ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯        ____    ____ __ ____ __ ____ __ ____ __ ____ __ ____    ___// 
    Function Import-ServiceConfiguration #______________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    {#/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯      
        [ CmdLetBinding () ] Param ( 
        
            [ Parameter ( ParameterSetName = "Default" ) ] [ Switch ] $Default ,
            [ Parameter ( ParameterSetName =    "Load" ) ] [ Switch ] $Load    ,
            [ Parameter ( ParameterSetname =  "Custom" ) ] [ String ] $Custom  )

        $C                   = ( Get-Service *_* | ? ServiceType -eq 224 )[0].Name.Split( '_' )[-1]
        $X                   = @( '[X]' , 'Disabled' , 'Manual' , 'Auto' , 'Auto (DS)' )

        If ( $Default )
        {
            $Config          = Resolve-Script -Config

            $Services        = $Config | GM | ? { $_.MemberType -eq "NoteProperty" } | % { $_.Name }

            $Return          = @( )

            0..( $Services.Count - 1 ) | % { 
                
                $S           = $Config.$( $Services[$_] ).Split(',')
            
                $Return     += [ PSCustomObject ]@{
                    
                    Service  = $Services[$_].Replace( "?????" , $C )
                    "10H:D+" = $X[$S[0]]
                    "10H:D-" = $X[$S[1]]
                    "10P:D+" = $X[$S[2]]
                    "10P:D-" = $X[$S[3]]
                    "DT:S+"  = $X[$S[4]]
                    "DT:S-"  = $X[$S[5]]
                    "DT:T+"  = $X[$S[6]]
                    "DT:T-"  = $X[$S[7]]
                    "LT:S+"  = $X[$S[8]]
                    "LT:S-"  = $X[$S[9]]
                }
            }

            $Return
        }

        If ( $Load )
        {
            $Scale           = @{  
            
                Base         = Resolve-Script -Path    | % { "$( $_.Parent        )\Services" }
                File         = Resolve-Script -Control | % { "$( $_.ServiceConfig ).csv"      }
        
            } | % { IPCSV ( "{0}\{1}" -f $_.Base , $_.File ) } | % { 
            
                IPCSV $_ | % {
                
                    [ PSCustomObject ]@{ 
                    
                        Service  = $_.Service
                        "10H:D+" = $X[$_."10H:D+"]
                        "10H:D-" = $X[$_."10H:D-"]
                        "10P:D+" = $X[$_."10P:D+"]
                        "10P:D-" = $X[$_."10P:D-"]
                        "DT:S+"  = $X[$_."DT:S+"]
                        "DT:S-"  = $X[$_."DT:S-"]
                        "DT:T+"  = $X[$_."DT:T+"]
                        "DT:T-"  = $X[$_."DT:T-"]
                        "LT:S+"  = $X[$_."LT:S+"]
                        "LT:S-"  = $X[$_."LT:S-"]
                    }
                }
            }
        }

        If ( $Custom )
        {
            $Custom = Read-Host "Enter full path to custom service configuration"
            
            If ( ! ( Test-Path $Custom ) )
            {
                Write-Theme -Action "Exception [!]" "Path not a valid file."
            }

            If ( $Custom.Split('.')[-1] -ne ".csv" )
            {
                Write-Theme -Action "Exception [!]" "File not in a valid .csv format"
            }
        }                                                                           #____ -- ____    ____ -- ____    ____ -- ____    ____ -- ____      
}#____                                                                            __//¯¯\\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//¯¯\\___  
#//¯¯\\__________________________________________________________________________/¯¯¯    ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯        ____    ____ __ ____ __ ____ __ ____ __ ____ __ ____    ___// 
    Function New-ServiceTemplate #______________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    {#/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯      
        [ CmdLetBinding () ] Param (

            [ ValidateNotNullOrEmpty () ]
            [ Parameter ( ParameterSetname = "Object" ) ] [ String [] ] $Names )

        
        $Return = [ PSCustomObject ]@{ }

        $Names | % { $Return | Add-Member -MemberType NoteProperty -Name $_ -Value "-" }

        $Return                                                                     #____ -- ____    ____ -- ____    ____ -- ____    ____ -- ____ 
}#____                                                                            __//¯¯\\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//¯¯\\___  
#//¯¯\\__________________________________________________________________________/¯¯¯    ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯        ____    ____ __ ____ __ ____ __ ____ __ ____ __ ____    ___// 
    Function Get-ServiceProfile #_______________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    {#/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯      

        Write-Theme -Action "Collecting [+]" "[ Service Configuration ]: Current Profile"

        Resolve-Script -Services             | % {

            $Filter                          = [ PSCustomObject ]@{ 
                
                Skipped                      = $_.Skip 
                Xbox                         = $_.Xbox
                DataGrid                     = $_.DataGrid
            }
        }

        $Current                             = Get-CurrentServices | Sort Name

        Write-Theme -Action  "Importing [+]" "[ Service Configuration ]: Target Profile"

        $List                                = Import-ServiceConfiguration -Default
        $Index                               = 0..( $List.Count - 1 )

        Write-Theme -Action "Processing [+]" "[ Service Configuration ]: Overlay"

        # Create Template & Output Containers

        $Service                             = [ PSCustomObject ]@{
        
            Profile                          = [ PSCustomObject ]@{ }
            Master                           = @( )
            Active                           = @( )
            Inactive                         = @( )
            Skipped                          = @( )
            Xbox                             = @( )
        }

        $Types                               = Resolve-Script -Types | % { $_.Types }

        $Types                               | % {
        
            $Splat                           = @{

                MemberType                   = "NoteProperty"
                Name                         = $_
                Value                        = ForEach ( $i in $Index )
                {
                    [ PSCustomObject ]@{

                        Index                = $I
                        Scoped               = "-"
                        Profile              = $List[$I].$_
                        Name                 = $List[$I].Service
                        
                    }
                }
            }

            $Service.Profile                 | Add-Member @Splat
        }

        ForEach ( $I in $Index )
        {
            $New                             = New-ServiceTemplate -Names $Filter.DataGrid

            $New.Index                       = "{0:d3}" -f $I
            $New.Name                        = $List[$I].Service
            
            If ( $New.Name -in $Current.Name )
            {
                $X                           = $Current | ? { $_.Name -eq $New.Name }

                $New.Scoped                  = "+"
                $New.Status                  = $X.Status
                $New.StartType               = $X.StartType
                $New.DelayedAutoStart        = $X.DelayedAutoStart
                $New.DisplayName             = $X.DisplayName
                $New.PathName                = $X.PathName
                $New.Description             = $X.Description
            }

            $New.Status                      | % {

                If ( $_ -eq "Running" )
                {
                    $Service.Active         += $New.Name
                }

                If ( $_ -eq "Stopped" )
                {
                    $Service.Inactive       += $New.Name
                }

                If ( ( $_ -eq "-" ) -or ( $New.Name -in $Filter.Skipped ) )
                {
                    $Service.Skipped        += $New.Name
                }

                If ( $New.Name -in $Filter.Xbox )
                { 
                    $Service.Xbox           += $New.Name
                }

                If ( $New.Name -in $List.Service )
                {
                    If ( $New.Scoped -eq "+" )
                    {
                        ForEach ( $T in $Types )
                        {
                            $Service.Profile.$T[$I] | % { 

                                $_.Scoped = "+"

                                If ( ( $_.Profile -eq $New.StartType ) -or ( $_.Profile -like "*DS*" -and $New.DelayedAutoStart -ne $Null ) )
                                {
                                    $_.Scoped = "@"
                                }
                            }
                        }
                    }
                }
            }

            $Service.Master += $New
        }

        $Service | % { 

            $Return                          = [ PSCustomObject ]@{

                "10H:D+"                         = $_.Profile."10H:D+"
                "10H:D-"                         = $_.Profile."10H:D-"
                "10P:D+"                         = $_.Profile."10P:D+"
                "10P:D-"                         = $_.Profile."10P:D-"
                "DT:S+"                          = $_.Profile."DT:S+"
                "DT:S-"                          = $_.Profile."DT:S-"
                "DT:T+"                          = $_.Profile."DT:T+"
                "DT:T-"                          = $_.Profile."DT:T-"
                "LT:S+"                          = $_.Profile."LT:S+"
                "LT:S-"                          = $_.Profile."LT:S-"
                Master                           = @( $_.Master )
                DisplayActive                    = @( $_.Active )
                DisplayInactive                  = @( $_.Inactive )
                DisplaySkipped                   = @( $_.Skipped )
                MiscXbox                         = @( $_.Xbox )
            }
        }

        $Return                                                                     #____ -- ____    ____ -- ____    ____ -- ____    ____ -- ____      
}#____                                                                            __//¯¯\\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//¯¯\\___  
#//¯¯\\__________________________________________________________________________/¯¯¯    ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯        ____    ____ __ ____ __ ____ __ ____ __ ____ __ ____    ___// 
    Function Show-Console #_____________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    {#/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯      
        Param ( [ Bool ] $Switch )

            [ Console.Window ]::ShowWindow( [ Console.Window ]::GetConsoleWindow() , $( If ( $Switch ) { 5 } Else { 0 } ) )
    
                                                                                    #____ -- ____    ____ -- ____    ____ -- ____    ____ -- ____      
}#____                                                                            __//¯¯\\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//¯¯\\___  
#//¯¯\\__________________________________________________________________________/¯¯¯    ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯        ____    ____ __ ____ __ ____ __ ____ __ ____ __ ____    ___// 
    Function Load-MadBombRevisedGUI #___________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    {#/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯      

        # OS Version

        [ Environment ]::OSVersion.Version.Major | % {
        
            If ( $_ -ne 10 )
            {
                Write-Theme -Action "Exception [!]" "Only Windows 10 Client is currently supported" 12 4 15
                Read-Host "Press Enter to Exit"
                Break
            }

            Else
            {
                $Splat               = @{ 
                
                    Name             = "Window"
                    Namespace        = "Console"
                    MemberDefinition = '[DllImport("Kernel32.dll")] public static extern IntPtr GetConsoleWindow();' , 
                                       '[DllImport("user32.dll")]   public static extern bool ShowWindow(IntPtr hWnd, Int32 nCmdShow);' -join "`n"
                }

                Add-Type @Splat
            }
        }

        # Administrative Rights

        "Security.Principal.Windows" | % { IEX "( [ $_`Principal ][ $_`Identity ]::GetCurrent() ).IsInRole( 'Administrator' )" } | % {

            If ( $False ) 
            {                
                Write-Theme -Action "Access [!]" "Limited, attempting elevation" 12 4 15

                SAPS PowerShell "-NoProfile -ExecutionPolicy Bypass -File `"$PSCommandPath`" $PassedArg" -Verb RunAs
                
                If ( $False )
                { 
                    Write-Theme -Action "Exception [!]" "Elevation has failed" 12 4 15
                    Read-Host "Press Enter to Exit"
                    Break
                }
            }

            If ( $True )
            { 
                Write-Theme -Action "Confirmed [+]" "Administrative Rights" 11 11 15 
            }
        }

        $Control                                   = Resolve-Script -Control
 
        If ( $Control.TermsOfService -eq 0 )
        {
            Write-Theme -Array ( Resolve-Script -Copyright ) -Title "Terms of Service / Copyright" -Prompt "Press Enter to Continue" | % { 

                If ( $_ -eq $True )
                {
                    Write-Theme -Action "Accepted [+]" "Terms of Service" 11 11 15
                    
                    $Control.TermsOfService        = 1

                    $MSInfo                        = Resolve-Windows -MSInfo
                    $System                        = Resolve-Windows -System
                    $Path                          = Resolve-Script -Path | % { $_.Parent , "Services" -join '\' }
                    $MadBomb                       = Resolve-Script -MadBomb
                    $Company                       = Resolve-Script -Company
                    $Sparks                        = Resolve-Script -Sparks
        
                    $Chassis                       = Resolve-Windows -Type | % { $_.Chassis }

                    $Config                        = Get-ServiceProfile
        
                    $Service                       = @( )

                    Resolve-Script -Types          | % {
                
                        $Types                     = $_.Types 
                        $Titles                    = $_.Titles
                    }

                    Return-ViperBombGUI -Main      | % {
        
                        $Xaml                      = $_.Xaml
                        $GUI                       = $_.GUI
                        $Named                     = $_.Named
                    }
                }

                Else 
                {
                    Write-Theme -Action "Exception [!]" "Terms of Service was not accepted, aborting" 12 4 15
                    Read-Host "Press Enter to Exit"
                    Break
                }
            }
        }

        # Defaults

        $GUI.DisplayActive.IsChecked                = $True
        $GUI.DisplayInactive.IsChecked              = $True
        $GUI.DisplaySkipped.IsChecked               = $True

        $GUI.CurrentOS.Text                         = "{0} ({1})" -f $MSInfo.Caption , $env:PROCESSOR_ARCHITECTURE.Replace( 'AMD' , 'x' )
        $GUI.CurrentBuild.Text                      = $PSVersionTable.BuildVersion
        $GUI.CurrentChassis.Text                    = $Chassis

        $GUI.ServiceDialogEmpty.Text                = "Select a profile from the configuration menu to begin"
        $GUI.ServiceDialogSearch.IsEnabled          = $False
        $GUI.ServiceLabel.Text                      = $GUI.ServiceProfile.SelectedItem.Content
        $GUI.ScriptLabel.Text                       = $GUI.ScriptProfile.SelectedItem.Content

        Function Refresh-DataGrid
        {
            [ CmdLetBinding () ] Param (

                [ Parameter ( Mandatory ) ] [ Windows.Window ] $GUI     ,
                [ Parameter ( Mandatory ) ] [ PSCustomObject ] $Control ,
                [ Parameter ( Mandatory ) ] [ PSCustomObject ] $Config  )

            If ( ! $GUI.ServiceDialogSearch.IsEnabled )
            { 
                $GUI.ServiceDialogSearch.IsEnabled  = $True
                $GUI.ServiceDialogEmpty.Visibility  = "Collapsed"
                $GUI.ServiceDialogEmpty.Text        = "" 
            }

            Resolve-Script -Types                   | % {

                $Type                               = ( $_.Types  )[ $Control.Profile ]
                $GUI.CurrentProfile.Text            = ( $_.Titles )[ $Control.Profile ]
            }

            $Service                                = @( )
            
            0..( $Config.Master.Count - 1 )         | % {

                $Service                           += [ PSCustomObject ]@{ 

                    Index                           = $Config.Master[$_].Index
                    Scoped                          = $Config.$Type[$_].Scoped
                    Profile                         = $Config.$Type[$_].Profile
                    Name                            = $Config.$Type[$_].Name
                    Status                          = $Config.Master[$_].Status
                    StartType                       = $Config.Master[$_].StartType
                    DelayedAutoStart                = $Config.Master[$_].DelayedAutoStart
                    DisplayName                     = $Config.Master[$_].DisplayName
                    PathName                        = $Config.Master[$_].PathName
                    Description                     = $Config.Master[$_].Description
                }
            }

            $GUI.ServiceDialogGrid.ItemsSource      = $Null

            $Output                                 = @( )

            If ( $Control.DisplayActive   -eq 1 ) { $Output += @( $Config.DisplayActive   ) }
            If ( $Control.DisplayInactive -eq 1 ) { $Output += @( $Config.DisplayInactive ) }
            If ( $Control.DisplaySkipped  -eq 1 ) { $Output += @( $Config.DisplaySkipped  ) }
            If ( $Control.MiscXbox        -eq 1 ) { $Output += @( $Config.MiscXbox        ) }

            If ( $Output.Count -gt 0 )
            {
                $Output                             = $Output  | ? { $_ -ne $Null } | Sort
                $Service                            = $Service | ? { $_.Name -in $Output }
            }

            $GUI.ServiceDialogGrid.ItemsSource      = $Service

            [ PSCustomObject ]@{ Service            = $Service }
        }

        $Select = {
        
            If ( $Control.Profile -in 0..9 ) 
            { 
                Refresh-DataGrid -GUI $GUI -Control $Control -Config $Config | % { $Service = $_.Service } 
            }
        }

        $GUI.MenuInfoFeedback.Add_Click({             Start $Company.Base   })
        $GUI.MenuInfoFAQ.Add_Click({                  Start $Company.About  })
        $GUI.MenuInfoAbout.Add_Click({                Show-Message -Title "About - ViperBomb Service Configuration Utility" -Message ( Resolve-Script -Message ) })
        $GUI.MenuInfoCopyright.Add_Click({            Show-Message -Title "Copyright" -Message ( ( Resolve-Script -Copyright ) -join "`n" ) })
        $GUI.MenuInfoMadBombDonate.Add_Click({        Start $MadBomb.Donate  })
        $GUI.MenuInfoMadBombGitHub.Add_Click({        Start $MadBomb.Base    })
        $GUI.MenuInfoBlackViper.Add_Click({           Start $Sparks.Website  })
        $GUI.MenuInfoSecureDigitsPlus.Add_Click({     Start $Company.Site    })

        $GUI.MenuConfigHomeDefaultMax.Add_Click({     $Control.Profile         = 0 ; & $Select })
        $GUI.MenuConfigHomeDefaultMin.Add_Click({     $Control.Profile         = 1 ; & $Select })
        $GUI.MenuConfigProDefaultMax.Add_Click({      $Control.Profile         = 2 ; & $Select })
        $GUI.MenuConfigProDefaultMin.Add_Click({      $Control.Profile         = 3 ; & $Select })
        $GUI.MenuConfigDesktopSafeMax.Add_Click({     $Control.Profile         = 4 ; & $Select })
        $GUI.MenuConfigDesktopSafeMin.Add_Click({     $Control.Profile         = 5 ; & $Select })
        $GUI.MenuConfigDesktopTweakedMax.Add_Click({  $Control.Profile         = 6 ; & $Select })
        $GUI.MenuConfigDesktopTweakedMin.Add_Click({  $Control.Profile         = 7 ; & $Select })
        $GUI.MenuConfigLaptopSafeMax.Add_Click({      $Control.Profile         = 8 ; & $Select })
        $GUI.MenuConfigLaptopSafeMin.Add_Click({      $Control.Profile         = 9 ; & $Select })

        $GUI.DisplayActive.Add_Unchecked({            $Control.DisplayActive   = 0 ; & $Select })
        $GUI.DisplayActive.Add_Checked({              $Control.DisplayActive   = 1 ; & $Select })
        $GUI.DisplayInactive.Add_Unchecked({          $Control.DisplayInactive = 0 ; & $Select })
        $GUI.DisplayInactive.Add_Checked({            $Control.DisplayInactive = 1 ; & $Select })
        $GUI.DisplaySkipped.Add_Unchecked({           $Control.DisplaySkipped  = 0 ; & $Select })
        $GUI.DisplaySkipped.Add_Checked({             $Control.DisplaySkipped  = 1 ; & $Select })
        $GUI.MiscXbox.Add_Unchecked({                 $Control.MiscXbox        = 0 ; & $Select })
        $GUI.MiscXbox.Add_Checked({                   $Control.MiscXbox        = 1 ; & $Select })

        $GUI.ServiceDialogSearch.Add_TextChanged(
        {
            If ( ( $GUI.ServiceDialogSearch.Text -ne "" ) -and ( $GUI.ServiceDialogSelect.IsEnabled -eq $True ) )
            {
                $GUI.ServiceDialogSelect.IsEnabled      = $False
                $Filter                                 = $GUI.ServiceDialogSelect.SelectedItem.Content
                $Immute                                 = $GUI.ServiceDialogGrid.ItemsSource.Clone()
            }

            If ( $GUI.ServiceDialogSearch.Text -ne "" )
            {
                $GUI.ServiceDialogGrid.ItemsSource      = $Null
                $Text                                   = $GUI.ServiceDialogSearch.Text

                $Return                                 = $Immute.Clone() | ? { $_.$Filter -match $Text }

                $Out                                    = @{  
                
                    $True  = "Visible"   , $Return , "Collapsed" , "" 
                    $False = "Collapsed" , $Null   , "Visible"   , "No results found" 
                    
                }[ $Return.Count -gt 0 ]

            }

            If ( ( $GUI.ServiceDialogSearch.Text -eq "" ) -and ( $GUI.ServiceDialogSelect.IsEnabled -ne $True ) )
            {
                $GUI.ServiceDialogSelect.IsEnabled  = $True
                $Out                                = "Visible" , $Immute.Clone() , "Collapsed" , ""
            }

            $GUI.ServiceDialogGrid.Visibility       = $Out[0]
            $GUI.ServiceDialogGrid.ItemsSource      = $Out[1]
            $GUI.ServiceDialogEmpty.Visibility      = $Out[2]
            $GUI.ServiceDialogEmpty.Text            = $Out[3]
        })

        # ----------- #
        # Preferences #
        # ----------- #

        Function Open-FileDialog
        {
            [ CmdLetBinding() ] Param ( 

                [ Validateset( 0 , 1 , 2 , 3 ) ]
                [ Parameter (      Mandatory ) ] [            Int ] $ItemDialog , 
                [ Parameter (      Mandatory ) ] [ Windows.Window ] $GUI        ,
                [ Parameter (      Mandatory ) ] [ PSCustomObject ] $Control    )

            $ItemDialog      | % { 

                $Item        = [ PSCustomObject ]@{ 
            
                    Item     = ( $GUI.LoggingServiceFile , $GUI.LoggingScriptFile , $GUI.BackupRegistryFile , $GUI.BackupTemplateFile )[$_]
                    Object   = ( $Control | % { $_.LoggingServiceFile , $_.LoggingScriptFile , $_.BackupRegistryFile , $_.BackupTemplateFile } )[$_]
                    Caption  = @( "Service Logging" , "Script Logging" , "Registry Backup" , "Template Backup" | % { "Designate $_ File" } )[$_]
                    FileType = @( "log" , "log" , "reg" , "csv" | % { "$_ (*.$_) | *.$_" } )[$_]
                    FileName = @( "Service.log" , "Script.log" , "Backup.reg" , "Template.csv" )[$_]
                }
            }

            $Item.Item                              | % {
                    
                $_.IsEnabled                        = $True
                $_.Text                             = ( Get-Date -UFormat "%Y%m%d_%H%M" ) , $Item.Object -join '_'
            }

            $Dialog                                 = New-Object System.Windows.Forms.SaveFileDialog
                    
            $Dialog                                 | % {

                $_.Title                            = $Item.Caption
                $_.InitialDirectory                 = $Path
                $_.Filter                           = $Item.FileType
                $_.Filename                         = ( Get-Date -UFormat "%Y%m%d-%H_%M" ) , $Item.FileName -join '_'
            }

            $X                                      = $Dialog.ShowDialog()

            If ( $X -eq "OK" )
            {
                $Item.Item.Text                     = $Dialog.Filename
            }

            Else
            {
                $Item.Item                          | % {
                          
                    $_.IsEnabled                    = $False
                    $_.Text                         = "<Activate to designate a different file name/path>"
                }
            }

            $Dialog.Dispose()
            
        }

        $GUI.LoggingServiceBrowse.Add_Click({ Open-FileDialog -Item 0 -GUI $GUI -Control $Control })
        $GUI.LoggingScriptBrowse.Add_Click({  Open-FileDialog -Item 1 -GUI $GUI -Control $Control })
        $GUI.BackupRegistryBrowse.Add_Click({ Open-FileDialog -Item 2 -GUI $GUI -Control $Control })
        $GUI.BackupTemplateBrowse.Add_Click({ Open-FileDialog -Item 3 -GUI $GUI -Control $Control })

        #$GUI.MiscSimulate
        #$GUI.MiscChange
        #$GUI.MiscStopDisabled

        #$GUI.DevelDiagErrors
        #$GUI.DevelLog
        #$GUI.DevelConsole
        #$GUI.DevelDiagReport

        #$GUI.BypassBuild
        #$GUI.BypassEdition
        #$GUI.BypassLaptop

        #$GUI.MiscSimulate   [ What If ]
        # Produce a list of services and corresponding changes
        
        #$GUI.MiscChange [ Change the service state ]
        # If running, and non compliant, change the state

        #$GUI.MiscStopDisabled 
        # If a disabled service is running, stop them?

        #$GUI.DevelDiagErrors

        #$GUI.DevelLog
        #$GUI.DevelConsole
        #$GUI.DevelDiagReport
        
        # ------------------------ #

        
        $GUI.ServiceProfile.Add_SelectionChanged( { $GUI.ServiceLabel.Text = $GUI.ServiceProfile.SelectedItem.Content })
        $GUI.ScriptProfile.Add_SelectionChanged(  { $GUI.ScriptLabel.Text  = $GUI.ScriptProfile.SelectedItem.Content })

        # ------------------------ #

        #$GUI.ConsoleOutput
        #$GUI.DiagnosticOutput

        #$GUI.Start

        $GUI.Cancel.Add_Click({ $GUI.DialogResult = $False })

        $GUI | % { $_.LoggingServiceFile , $_.LoggingScriptFile , $_.BackupRegistryFile , $_.BackupTemplateFile } | % { 
        
            $_.Text = "<Activate to designate a different file name/path>"
        }

        Show-WPFWindow -GUI $GUI

        #------------------------#
        #   Post-Dialog Logic    #
        #------------------------#

        # This will be where the post dialog logic goes that handles the output of the script. It will be kick started
        # when the $GUI.Start is wired up to process the error correction/validation of everything that the program
        # allowed the user to enter/use... and if the output is validated, then the instructions/actions afterward go here.

        # For other examples of how this process works, feel free to scope out the Install-HybridDSC or Initialize-DomainController
        # functions in the main module.

                                                                                     #____ -- ____    ____ -- ____    ____ -- ____    ____ -- ____      
}#____                                                                             __//¯¯\\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//¯¯\\___  
#//¯¯\\___________________________________________________________________________/¯¯¯    ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯        ____    ____ __ ____ __ ____ __ ____ __ ____ __ ____    ___// 
        IPMO Hybrid-DSC -Force # What Free Actually Means _______________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
     #¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯      

#StartScript -Global $Control
